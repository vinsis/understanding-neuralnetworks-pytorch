```python
import torch
import torch.nn as nn
```

### 3D tensors


```python
x = torch.arange(2*3*4).view(2,3,4).float()
y = nn.InstanceNorm1d(3)(x)
z = nn.LayerNorm(4, elementwise_affine=False)(x)
```


```python
num = x - x.mean(-1, keepdim=True)
den = (num.pow(2).mean(-1, keepdim=True) + 1e-5).sqrt()
num/den
```




    tensor([[[-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416]],
    
            [[-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416]]])




```python
z
```




    tensor([[[-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416]],
    
            [[-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416]]])




```python
y
```




    tensor([[[-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416]],
    
            [[-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416],
             [-1.3416, -0.4472,  0.4472,  1.3416]]])



However, `y` and `z` are not identical (I don't know why):


```python
(y - z).abs().max()
```




    tensor(1.1921e-06)



### 4D tensors


```python
x = torch.arange(2*3*4*5).view(2,3,4,5).float()
y = nn.InstanceNorm2d(3)(x)
z = nn.LayerNorm(5, elementwise_affine=False)(x)
z2 = nn.LayerNorm([4,5], elementwise_affine=False)(x)
```


```python
num = x - x.view(2,3,-1).mean(-1, keepdim=True).unsqueeze(-1)
den = (num.view(2,3,-1).pow(2).mean() + 1e-5).sqrt()
(num/den)[0,0]
```




    tensor([[-1.6475, -1.4741, -1.3007, -1.1272, -0.9538],
            [-0.7804, -0.6070, -0.4336, -0.2601, -0.0867],
            [ 0.0867,  0.2601,  0.4336,  0.6070,  0.7804],
            [ 0.9538,  1.1272,  1.3007,  1.4741,  1.6475]])




```python
y[0,0]
```




    tensor([[-1.6475, -1.4741, -1.3007, -1.1272, -0.9538],
            [-0.7804, -0.6070, -0.4336, -0.2601, -0.0867],
            [ 0.0867,  0.2601,  0.4336,  0.6070,  0.7804],
            [ 0.9538,  1.1272,  1.3007,  1.4741,  1.6475]])




```python
z2[0,0]
```




    tensor([[-1.6475, -1.4741, -1.3007, -1.1272, -0.9538],
            [-0.7804, -0.6070, -0.4336, -0.2601, -0.0867],
            [ 0.0867,  0.2601,  0.4336,  0.6070,  0.7804],
            [ 0.9538,  1.1272,  1.3007,  1.4741,  1.6475]])




```python
num = x - x.mean(-1, keepdim=True)
den = (num.pow(2).mean(-1, keepdim=True) + 1e-5).sqrt()
(num/den)[0,0]
```




    tensor([[-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142]])




```python
z[0,0]
```




    tensor([[-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142]])




```python
num = x - x.mean(-1, keepdim=True)
den = (x.var(-1, keepdim=True, unbiased=False) + 1e-5).sqrt()
(num/den)[0,0]
```




    tensor([[-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142],
            [-1.4142, -0.7071,  0.0000,  0.7071,  1.4142]])




```python

```
